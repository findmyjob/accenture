<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Tryit Editor (Demo)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.7.0/sql-wasm.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f8f8f8; }
    .container { max-width: 900px; margin: 40px auto; padding: 24px; background: white; border-radius: 12px; box-shadow: 0 0 16px #0001; }
    h1 { margin-top: 0; font-size: 2em; }
    textarea { width: 100%; height: 120px; font-family: monospace; font-size: 1em; padding: 12px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 12px; }
    button { padding: 10px 24px; font-size: 1em; border-radius: 8px; border: none; background: #1e90ff; color: white; cursor: pointer; margin-bottom: 18px;}
    button:hover { background: #1877cc; }
    .result-table { border-collapse: collapse; margin-top: 12px; width: 100%; }
    .result-table th, .result-table td { border: 1px solid #ddd; padding: 8px; }
    .result-table th { background: #f2f2f2; }
    .error { color: #d60000; margin: 12px 0; }
    .sample-section { background: #f4f8fc; border: 1px solid #e0eaf7; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
    .sample-section code { background: #eef4fc; padding: 2px 6px; border-radius: 4px; }
    @media (max-width: 600px) {
      .container { padding: 10px; }
      textarea { height: 80px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SQL Tryit Editor (Demo)</h1>
    <div class="sample-section">
      <strong>Sample tables:</strong>
      <ul>
        <li><code>Customers</code> (CustomerID, CustomerName, Country)</li>
        <li><code>Orders</code> (OrderID, CustomerID, OrderDate, Amount)</li>
      </ul>
      Try:<br>
      <code>SELECT * FROM Customers;</code><br>
      <code>SELECT CustomerName, Country FROM Customers WHERE Country = 'Germany';</code>
    </div>
    <textarea id="sql-input">SELECT * FROM Customers;</textarea>
    <br>
    <button onclick="runSQL()">Run SQL &raquo;</button>
    <div id="error" class="error"></div>
    <div id="result"></div>
  </div>

  <script>
    let db;
    async function initDB() {
      const SQL = await initSqlJs({locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.7.0/${filename}`});
      db = new SQL.Database();
      // Sample schema and data (like W3Schools)
      db.run(`CREATE TABLE Customers (
        CustomerID INTEGER PRIMARY KEY,
        CustomerName TEXT,
        Country TEXT
      );`);
      db.run(`INSERT INTO Customers (CustomerName, Country) VALUES
        ('Alfreds Futterkiste','Germany'),
        ('Ana Trujillo Emparedados y helados','Mexico'),
        ('Antonio Moreno Taquería','Mexico'),
        ('Around the Horn','UK'),
        ('Berglunds snabbköp','Sweden'),
        ('Blauer See Delikatessen','Germany')
      ;`);
      db.run(`CREATE TABLE Orders (
        OrderID INTEGER PRIMARY KEY,
        CustomerID INTEGER,
        OrderDate TEXT,
        Amount REAL
      );`);
      db.run(`INSERT INTO Orders (CustomerID, OrderDate, Amount) VALUES
        (1, '2023-01-08', 240.20),
        (1, '2023-02-03', 179.99),
        (2, '2023-03-01', 82.50),
        (4, '2023-03-15', 105.00),
        (5, '2023-04-01', 20.00)
      ;`);
    }

    function escapeHTML(str) {
      return str.replace(/[&<>'"]/g, t => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[t]));
    }

    function runSQL() {
      document.getElementById('error').textContent = '';
      document.getElementById('result').innerHTML = '';
      let sql = document.getElementById('sql-input').value;
      try {
        let results = db.exec(sql);
        if (!results.length) {
          document.getElementById('result').innerHTML = "<em>No results returned.</em>";
          return;
        }
        let html = '';
        results.forEach(({columns, values}) => {
          html += `<table class="result-table"><thead><tr>`;
          columns.forEach(c => html += `<th>${escapeHTML(c)}</th>`);
          html += `</tr></thead><tbody>`;
          values.forEach(row => {
            html += `<tr>`;
            row.forEach(cell => html += `<td>${escapeHTML(String(cell))}</td>`);
            html += `</tr>`;
          });
          html += `</tbody></table>`;
        });
        document.getElementById('result').innerHTML = html;
      } catch (e) {
        document.getElementById('error').textContent = e.message;
      }
    }

    // Initialize DB on page load
    window.onload = async () => {
      await initDB();
    };
  </script>
</body>
</html>
